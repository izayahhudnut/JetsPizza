"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/recommend-products";
exports.ids = ["pages/api/recommend-products"];
exports.modules = {

/***/ "compute-cosine-similarity":
/*!********************************************!*\
  !*** external "compute-cosine-similarity" ***!
  \********************************************/
/***/ ((module) => {

module.exports = require("compute-cosine-similarity");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "node-cache":
/*!*****************************!*\
  !*** external "node-cache" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("node-cache");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Frecommend-products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Frecommend-products.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Frecommend-products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Frecommend-products.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_recommend_products_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/recommend-products.ts */ \"(api)/./pages/api/recommend-products.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_recommend_products_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_recommend_products_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_recommend_products_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_recommend_products_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/recommend-products\",\n        pathname: \"/api/recommend-products\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_recommend_products_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnJlY29tbWVuZC1wcm9kdWN0cyZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGcmVjb21tZW5kLXByb2R1Y3RzLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQzhEO0FBQzlEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyw2REFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsNkRBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZnJvbnRlbmQvP2QwZWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9yZWNvbW1lbmQtcHJvZHVjdHMudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9yZWNvbW1lbmQtcHJvZHVjdHNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9yZWNvbW1lbmQtcHJvZHVjdHNcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Frecommend-products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Frecommend-products.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/recommend-products.ts":
/*!*****************************************!*\
  !*** ./pages/api/recommend-products.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(pg__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_cache__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node-cache */ \"node-cache\");\n/* harmony import */ var node_cache__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_cache__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__]);\nopenai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// import { NextApiRequest, NextApiResponse } from \"next\";\n// import OpenAI from \"openai\";\n// import { Pool } from \"pg\";\n// var similarity = require(\"compute-cosine-similarity\");\n// import NodeCache from \"node-cache\";\n// const cache = new NodeCache({ stdTTL: 300 });\n// const pool = new Pool({\n//     connectionString: process.env.PRODUCTS_DATABASE_URL,\n//     ssl: { rejectUnauthorized: false },\n// });\n// const openai = new OpenAI({\n//     apiKey: process.env.OPENAI_API_KEY,\n// });\n// export default async function handler(\n//     req: NextApiRequest,\n//     res: NextApiResponse\n// ) {\n//     if (req.method !== \"POST\") {\n//         res.status(405).json({ error: \"Method not allowed\" });\n//         return;\n//     }\n//     const { userInput } = req.body;\n//     console.log(userInput, \"userInput\");\n//     try {\n//         const cachedResponse = cache.get(userInput);\n//         if (cachedResponse) {\n//             res.status(200).json(cachedResponse);\n//             return;\n//         }\n//         const embeddingResponse = await openai.embeddings.create({\n//             model: \"text-embedding-ada-002\",\n//             input: userInput,\n//         });\n//         const userEmbedding = embeddingResponse.data[0].embedding;\n//         const client = await pool.connect();\n//         try {\n//             const result = await client.query(\n//                 \"SELECT product_name, strain_type, brand_name, cbd, image, price, dispensary, options, thc, sales, embedding FROM products\"\n//             );\n//             const products = result.rows;\n//             const similarities = products.map((product) => ({\n//                 ...product,\n//                 similarity: similarity(userEmbedding, product.embedding),\n//             }));\n//             similarities.sort((a, b) => b.similarity - a.similarity);\n//             const topProducts = similarities\n//                 .slice(0, 3)\n//                 .map(({ embedding, ...product }) => product);\n//             cache.set(userInput, topProducts);\n//             res.status(200).json(topProducts);\n//         } finally {\n//             client.release();\n//         }\n//     } catch (err: any) {\n//         console.error(err);\n//         res.status(500).json({ error: err.message });\n//     }\n// }\n\n\n\nconst similarity = __webpack_require__(/*! compute-cosine-similarity */ \"compute-cosine-similarity\");\nconst cache = new (node_cache__WEBPACK_IMPORTED_MODULE_2___default())({\n    stdTTL: 300\n});\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_1__.Pool({\n    connectionString: process.env.PRODUCTS_DATABASE_URL,\n    ssl: {\n        rejectUnauthorized: false\n    }\n});\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        res.status(405).json({\n            error: \"Method not allowed\"\n        });\n        return;\n    }\n    const { userInput } = req.body;\n    console.log(userInput, \"userInput\");\n    try {\n        const cachedResponse = cache.get(userInput);\n        if (cachedResponse) {\n            res.status(200).json(cachedResponse);\n            return;\n        }\n        const embeddingResponse = await openai.embeddings.create({\n            model: \"text-embedding-ada-002\",\n            input: userInput\n        });\n        const userEmbedding = embeddingResponse.data[0].embedding;\n        const client = await pool.connect();\n        try {\n            const result = await client.query(\"SELECT product_name, strain_type, brand_name, cbd, image, price, dispensary, options, thc, sales, embedding FROM products\");\n            const products = result.rows;\n            const similarities = products.map((product)=>{\n                if (!product.embedding || !Array.isArray(product.embedding)) {\n                    console.error(\"Invalid product embedding:\", product);\n                    return {\n                        ...product,\n                        similarity: null\n                    };\n                }\n                try {\n                    return {\n                        ...product,\n                        similarity: similarity(userEmbedding, product.embedding)\n                    };\n                } catch (error) {\n                    console.error(\"Error computing similarity:\", error);\n                    return {\n                        ...product,\n                        similarity: null\n                    };\n                }\n            });\n            similarities.sort((a, b)=>(b.similarity ?? 0) - (a.similarity ?? 0));\n            const topProducts = similarities.filter((product)=>product.similarity !== null).slice(0, 10).map(({ embedding, ...product })=>product);\n            cache.set(userInput, topProducts);\n            res.status(200).json(topProducts);\n        } finally{\n            client.release();\n        }\n    } catch (err) {\n        console.error(err);\n        res.status(500).json({\n            error: err.message\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUgsS0FBSyxDQUFDLDhCQUE4QnVCO29CQUM1QyxPQUFPO3dCQUNILEdBQUdBLE9BQU87d0JBQ1YzQyxZQUFZO29CQUNoQjtnQkFDSjtnQkFDQSxJQUFJO29CQUNBLE9BQU87d0JBQ0gsR0FBRzJDLE9BQU87d0JBQ1YzQyxZQUFZQSxXQUNSZ0MsZUFDQVcsUUFBUVQsU0FBUztvQkFFekI7Z0JBQ0osRUFBRSxPQUFPZCxPQUFPO29CQUNaRyxRQUFRSCxLQUFLLENBQUMsK0JBQStCQTtvQkFDN0MsT0FBTzt3QkFDSCxHQUFHdUIsT0FBTzt3QkFDVjNDLFlBQVk7b0JBQ2hCO2dCQUNKO1lBQ0o7WUFFQXlDLGFBQWFLLElBQUksQ0FDYixDQUFDQyxHQUFHQyxJQUFNLENBQUNBLEVBQUVoRCxVQUFVLElBQUksS0FBTStDLENBQUFBLEVBQUUvQyxVQUFVLElBQUk7WUFHckQsTUFBTWlELGNBQWNSLGFBQ2ZTLE1BQU0sQ0FBQyxDQUFDUCxVQUFZQSxRQUFRM0MsVUFBVSxLQUFLLE1BQzNDbUQsS0FBSyxDQUFDLEdBQUcsSUFDVFQsR0FBRyxDQUFDLENBQUMsRUFBRVIsU0FBUyxFQUFFLEdBQUdTLFNBQVMsR0FBS0E7WUFFeEN6QyxNQUFNa0QsR0FBRyxDQUFDL0IsV0FBVzRCO1lBQ3JCakMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQzhCO1FBQ3pCLFNBQVU7WUFDTmQsT0FBT2tCLE9BQU87UUFDbEI7SUFDSixFQUFFLE9BQU9DLEtBQVU7UUFDZi9CLFFBQVFILEtBQUssQ0FBQ2tDO1FBQ2R0QyxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU9rQyxJQUFJQyxPQUFPO1FBQUM7SUFDOUM7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL2Zyb250ZW5kLy4vcGFnZXMvYXBpL3JlY29tbWVuZC1wcm9kdWN0cy50cz83ZTQ2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiO1xuLy8gaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG4vLyBpbXBvcnQgeyBQb29sIH0gZnJvbSBcInBnXCI7XG4vLyB2YXIgc2ltaWxhcml0eSA9IHJlcXVpcmUoXCJjb21wdXRlLWNvc2luZS1zaW1pbGFyaXR5XCIpO1xuXG4vLyBpbXBvcnQgTm9kZUNhY2hlIGZyb20gXCJub2RlLWNhY2hlXCI7XG5cbi8vIGNvbnN0IGNhY2hlID0gbmV3IE5vZGVDYWNoZSh7IHN0ZFRUTDogMzAwIH0pO1xuXG4vLyBjb25zdCBwb29sID0gbmV3IFBvb2woe1xuLy8gICAgIGNvbm5lY3Rpb25TdHJpbmc6IHByb2Nlc3MuZW52LlBST0RVQ1RTX0RBVEFCQVNFX1VSTCxcbi8vICAgICBzc2w6IHsgcmVqZWN0VW5hdXRob3JpemVkOiBmYWxzZSB9LFxuLy8gfSk7XG5cbi8vIGNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoe1xuLy8gICAgIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4vLyB9KTtcblxuLy8gZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcbi8vICAgICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuLy8gICAgIHJlczogTmV4dEFwaVJlc3BvbnNlXG4vLyApIHtcbi8vICAgICBpZiAocmVxLm1ldGhvZCAhPT0gXCJQT1NUXCIpIHtcbi8vICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogXCJNZXRob2Qgbm90IGFsbG93ZWRcIiB9KTtcbi8vICAgICAgICAgcmV0dXJuO1xuLy8gICAgIH1cblxuLy8gICAgIGNvbnN0IHsgdXNlcklucHV0IH0gPSByZXEuYm9keTtcblxuLy8gICAgIGNvbnNvbGUubG9nKHVzZXJJbnB1dCwgXCJ1c2VySW5wdXRcIik7XG5cbi8vICAgICB0cnkge1xuLy8gICAgICAgICBjb25zdCBjYWNoZWRSZXNwb25zZSA9IGNhY2hlLmdldCh1c2VySW5wdXQpO1xuLy8gICAgICAgICBpZiAoY2FjaGVkUmVzcG9uc2UpIHtcbi8vICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKGNhY2hlZFJlc3BvbnNlKTtcbi8vICAgICAgICAgICAgIHJldHVybjtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIGNvbnN0IGVtYmVkZGluZ1Jlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmVtYmVkZGluZ3MuY3JlYXRlKHtcbi8vICAgICAgICAgICAgIG1vZGVsOiBcInRleHQtZW1iZWRkaW5nLWFkYS0wMDJcIixcbi8vICAgICAgICAgICAgIGlucHV0OiB1c2VySW5wdXQsXG4vLyAgICAgICAgIH0pO1xuLy8gICAgICAgICBjb25zdCB1c2VyRW1iZWRkaW5nID0gZW1iZWRkaW5nUmVzcG9uc2UuZGF0YVswXS5lbWJlZGRpbmc7XG5cbi8vICAgICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgcG9vbC5jb25uZWN0KCk7XG4vLyAgICAgICAgIHRyeSB7XG4vLyAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQucXVlcnkoXG4vLyAgICAgICAgICAgICAgICAgXCJTRUxFQ1QgcHJvZHVjdF9uYW1lLCBzdHJhaW5fdHlwZSwgYnJhbmRfbmFtZSwgY2JkLCBpbWFnZSwgcHJpY2UsIGRpc3BlbnNhcnksIG9wdGlvbnMsIHRoYywgc2FsZXMsIGVtYmVkZGluZyBGUk9NIHByb2R1Y3RzXCJcbi8vICAgICAgICAgICAgICk7XG4vLyAgICAgICAgICAgICBjb25zdCBwcm9kdWN0cyA9IHJlc3VsdC5yb3dzO1xuXG4vLyAgICAgICAgICAgICBjb25zdCBzaW1pbGFyaXRpZXMgPSBwcm9kdWN0cy5tYXAoKHByb2R1Y3QpID0+ICh7XG4vLyAgICAgICAgICAgICAgICAgLi4ucHJvZHVjdCxcbi8vICAgICAgICAgICAgICAgICBzaW1pbGFyaXR5OiBzaW1pbGFyaXR5KHVzZXJFbWJlZGRpbmcsIHByb2R1Y3QuZW1iZWRkaW5nKSxcbi8vICAgICAgICAgICAgIH0pKTtcblxuLy8gICAgICAgICAgICAgc2ltaWxhcml0aWVzLnNvcnQoKGEsIGIpID0+IGIuc2ltaWxhcml0eSAtIGEuc2ltaWxhcml0eSk7XG5cbi8vICAgICAgICAgICAgIGNvbnN0IHRvcFByb2R1Y3RzID0gc2ltaWxhcml0aWVzXG4vLyAgICAgICAgICAgICAgICAgLnNsaWNlKDAsIDMpXG4vLyAgICAgICAgICAgICAgICAgLm1hcCgoeyBlbWJlZGRpbmcsIC4uLnByb2R1Y3QgfSkgPT4gcHJvZHVjdCk7XG5cbi8vICAgICAgICAgICAgIGNhY2hlLnNldCh1c2VySW5wdXQsIHRvcFByb2R1Y3RzKTtcbi8vICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHRvcFByb2R1Y3RzKTtcbi8vICAgICAgICAgfSBmaW5hbGx5IHtcbi8vICAgICAgICAgICAgIGNsaWVudC5yZWxlYXNlKCk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuLy8gICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4vLyAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVyci5tZXNzYWdlIH0pO1xuLy8gICAgIH1cbi8vIH1cblxuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XG5pbXBvcnQgT3BlbkFJIGZyb20gXCJvcGVuYWlcIjtcbmltcG9ydCB7IFBvb2wgfSBmcm9tIFwicGdcIjtcbmltcG9ydCBOb2RlQ2FjaGUgZnJvbSBcIm5vZGUtY2FjaGVcIjtcbmNvbnN0IHNpbWlsYXJpdHkgPSByZXF1aXJlKFwiY29tcHV0ZS1jb3NpbmUtc2ltaWxhcml0eVwiKTtcblxuY29uc3QgY2FjaGUgPSBuZXcgTm9kZUNhY2hlKHsgc3RkVFRMOiAzMDAgfSk7XG5cbmNvbnN0IHBvb2wgPSBuZXcgUG9vbCh7XG4gICAgY29ubmVjdGlvblN0cmluZzogcHJvY2Vzcy5lbnYuUFJPRFVDVFNfREFUQUJBU0VfVVJMLFxuICAgIHNzbDogeyByZWplY3RVbmF1dGhvcml6ZWQ6IGZhbHNlIH0sXG59KTtcblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxuICAgIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gICAgcmVzOiBOZXh0QXBpUmVzcG9uc2Vcbikge1xuICAgIGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikge1xuICAgICAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBcIk1ldGhvZCBub3QgYWxsb3dlZFwiIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgeyB1c2VySW5wdXQgfSA9IHJlcS5ib2R5O1xuXG4gICAgY29uc29sZS5sb2codXNlcklucHV0LCBcInVzZXJJbnB1dFwiKTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNhY2hlZFJlc3BvbnNlID0gY2FjaGUuZ2V0KHVzZXJJbnB1dCk7XG4gICAgICAgIGlmIChjYWNoZWRSZXNwb25zZSkge1xuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oY2FjaGVkUmVzcG9uc2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZW1iZWRkaW5nUmVzcG9uc2UgPSBhd2FpdCBvcGVuYWkuZW1iZWRkaW5ncy5jcmVhdGUoe1xuICAgICAgICAgICAgbW9kZWw6IFwidGV4dC1lbWJlZGRpbmctYWRhLTAwMlwiLFxuICAgICAgICAgICAgaW5wdXQ6IHVzZXJJbnB1dCxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHVzZXJFbWJlZGRpbmcgPSBlbWJlZGRpbmdSZXNwb25zZS5kYXRhWzBdLmVtYmVkZGluZztcblxuICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBwb29sLmNvbm5lY3QoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5xdWVyeShcbiAgICAgICAgICAgICAgICBcIlNFTEVDVCBwcm9kdWN0X25hbWUsIHN0cmFpbl90eXBlLCBicmFuZF9uYW1lLCBjYmQsIGltYWdlLCBwcmljZSwgZGlzcGVuc2FyeSwgb3B0aW9ucywgdGhjLCBzYWxlcywgZW1iZWRkaW5nIEZST00gcHJvZHVjdHNcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RzID0gcmVzdWx0LnJvd3M7XG5cbiAgICAgICAgICAgIGNvbnN0IHNpbWlsYXJpdGllcyA9IHByb2R1Y3RzLm1hcCgocHJvZHVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcHJvZHVjdC5lbWJlZGRpbmcgfHwgIUFycmF5LmlzQXJyYXkocHJvZHVjdC5lbWJlZGRpbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnZhbGlkIHByb2R1Y3QgZW1iZWRkaW5nOlwiLCBwcm9kdWN0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnByb2R1Y3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1pbGFyaXR5OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucHJvZHVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbWlsYXJpdHk6IHNpbWlsYXJpdHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlckVtYmVkZGluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmVtYmVkZGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY29tcHV0aW5nIHNpbWlsYXJpdHk6XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnByb2R1Y3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1pbGFyaXR5OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzaW1pbGFyaXRpZXMuc29ydChcbiAgICAgICAgICAgICAgICAoYSwgYikgPT4gKGIuc2ltaWxhcml0eSA/PyAwKSAtIChhLnNpbWlsYXJpdHkgPz8gMClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IHRvcFByb2R1Y3RzID0gc2ltaWxhcml0aWVzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigocHJvZHVjdCkgPT4gcHJvZHVjdC5zaW1pbGFyaXR5ICE9PSBudWxsKVxuICAgICAgICAgICAgICAgIC5zbGljZSgwLCAxMClcbiAgICAgICAgICAgICAgICAubWFwKCh7IGVtYmVkZGluZywgLi4ucHJvZHVjdCB9KSA9PiBwcm9kdWN0KTtcblxuICAgICAgICAgICAgY2FjaGUuc2V0KHVzZXJJbnB1dCwgdG9wUHJvZHVjdHMpO1xuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24odG9wUHJvZHVjdHMpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgY2xpZW50LnJlbGVhc2UoKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogZXJyLm1lc3NhZ2UgfSk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbIk9wZW5BSSIsIlBvb2wiLCJOb2RlQ2FjaGUiLCJzaW1pbGFyaXR5IiwicmVxdWlyZSIsImNhY2hlIiwic3RkVFRMIiwicG9vbCIsImNvbm5lY3Rpb25TdHJpbmciLCJwcm9jZXNzIiwiZW52IiwiUFJPRFVDVFNfREFUQUJBU0VfVVJMIiwic3NsIiwicmVqZWN0VW5hdXRob3JpemVkIiwib3BlbmFpIiwiYXBpS2V5IiwiT1BFTkFJX0FQSV9LRVkiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwidXNlcklucHV0IiwiYm9keSIsImNvbnNvbGUiLCJsb2ciLCJjYWNoZWRSZXNwb25zZSIsImdldCIsImVtYmVkZGluZ1Jlc3BvbnNlIiwiZW1iZWRkaW5ncyIsImNyZWF0ZSIsIm1vZGVsIiwiaW5wdXQiLCJ1c2VyRW1iZWRkaW5nIiwiZGF0YSIsImVtYmVkZGluZyIsImNsaWVudCIsImNvbm5lY3QiLCJyZXN1bHQiLCJxdWVyeSIsInByb2R1Y3RzIiwicm93cyIsInNpbWlsYXJpdGllcyIsIm1hcCIsInByb2R1Y3QiLCJBcnJheSIsImlzQXJyYXkiLCJzb3J0IiwiYSIsImIiLCJ0b3BQcm9kdWN0cyIsImZpbHRlciIsInNsaWNlIiwic2V0IiwicmVsZWFzZSIsImVyciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/recommend-products.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Frecommend-products&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Frecommend-products.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();